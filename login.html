<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login Page</title>
    <link rel="stylesheet" href="css/login.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="cookies.js"></script>
</head>
<body>

<section class="section1">
    <div class="menu">
        <ul>
            <li class="topTitle">The Secret Adventure</li>
            <li><a href="index.html"> Home </a></li>
            <li>What's New</li>
            <li>About Us</li>
            <li><a href="#socials">Socials</a></li>
            <li><a class="play-btn" href="Questions.html">Play Now</a></li>
        </ul>
    </div>
</section>

<form class="login" onsubmit="return false;">
    <h5 id="title-login">Registration</h5>
    <p class="player-name"> Name: <input type="text" name="player" id="playerName"  required maxlength="20" minlength="2"/></p>
    <p  id="StartBTN"> <input type="submit" onclick="start()" value="Start the Game"/> </p>
</form>
<p id="test"></p>

<!--   comment     -->
<script>
    //let url = new URL('https://codecyprus.org/th/api/start?player=Team4&app=Team4App&treasure-hunt-id= ag9nfmNvZGVjeXBydXNvcmdyGQsSDFRyZWFzdXJlSHVudBiAgIC8u8zICAw\n');
    //console.log(url);

    function start() {
        let searchParams = new URLSearchParams(window.location.search);
        let treasureHuntID = searchParams.get("treasureHuntID");

        const playerName = document.getElementById("playerName").value;

        //TODO - Check if the value is blank.....
        if (document.getElementById("playerName").value.length === 0) {
            alert("empty");
        } else {
            console.log("treasureHuntID: " + treasureHuntID);
            console.log("playerName:" + playerName);


            fetch("https://codecyprus.org/th/api/start?player=" + playerName + "&app=Team4-2022&treasure-hunt-id=" + treasureHuntID)
                .then(response => response.json()) //Parse JSON text to JavaScript object
                .then(jsonObject => {
                    if (jsonObject.status === "OK") {
                        let sessionID = jsonObject.sessionId;
                        console.log(sessionID);
                        setCookie("sessionID", sessionID, 30);
                        window.location.href = "Questions.html";
                    } else {
                        let errorMessages = jsonObject.errorMessages;
                        let str = "";
                        for (let error in errorMessages) {
                            str += error;
                        }
                        alert(str);
                    }
                })
                .catch(error => {
                    alert(error);
                });

        }
    }


</script>



</body>
</html>